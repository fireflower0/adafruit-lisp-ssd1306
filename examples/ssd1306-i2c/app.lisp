(uiop:define-package #:ssd1306-i2c/app
  (:use #:cl
        #:adafruit-lisp-ssd1306/constants  
        #:ssd1306-i2c/wrapper/wiringpi
        #:adafruit-lisp-ssd1306/i2c)
  (:export #:main))
(in-package #:ssd1306-i2c/app)

(defun example-draw-pixel ()
  (ssd1306-draw-pixel  10 10 :color +white+)
  (ssd1306-draw-pixel 117 10 :color +white+)
  (ssd1306-draw-pixel 117 53 :color +white+)
  (ssd1306-draw-pixel  10 53 :color +white+)
  (ssd1306-display)
  (delay 1000)
  (ssd1306-clear-display))

(defun example-draw-line ()
  (ssd1306-draw-line 0 0 127 63)
  (ssd1306-draw-line 127 0 0 63)
  (ssd1306-display)
  (delay 1000)
  (ssd1306-clear-display))

(defun example-draw-rect ()
  (ssd1306-draw-rect 10 10 44 44 :color +white+)
  (ssd1306-draw-fill-rect 74 10 44 44 :color +white+)
  (ssd1306-display)
  (delay 1000)
  (ssd1306-clear-display))

(defun example-draw-triangle ()
  (ssd1306-draw-triangle 32 25 57 50 7 50 :color +white+)
  (ssd1306-draw-fill-triangle 96 25 121 50 71 50 :color +white+)
  (ssd1306-display)
  (delay 1000)
  (ssd1306-clear-display))

(defun example-draw-circle ()
  (ssd1306-draw-circle 32 32 30 :color +white+)
  (ssd1306-draw-fill-circle 96 32 30 :color +white+)
  (ssd1306-display)
  (delay 1000)
  (ssd1306-clear-display))

(defun example-invert-display ()
  (ssd1306-draw-fill-rect 10 10 108 44 :color +white+)
  (dotimes (n 10)
    (if (zerop (rem n 2))
        (ssd1306-invert-display t)
        (ssd1306-invert-display nil))
    (ssd1306-display)
    (delay 300))
  (delay 300)
  (ssd1306-clear-display))

(defun example-draw-string ()
  (ssd1306-draw-string 10 16 "Hello, world!" :fill t)
  (ssd1306-draw-string 10 32 "Hello, world!")
  (ssd1306-display)
  (delay 1000)
  (ssd1306-clear-display))

(defun example-draw-bmp ()
  (ssd1306-draw-bmp #P"~/.roswell/local-projects/fireflower0/cl-raspi/examples/cl-raspi-url.bmp")
  (ssd1306-draw-string 62  8 "cl-raspi")
  (ssd1306-draw-string 62 16 "Github")
  (ssd1306-draw-string 62 24 "URL")
  (ssd1306-display)
  (delay 5000)
  (ssd1306-clear-display))

(defun main (&rest args)
  (ssd1306-init)
  (example-draw-pixel)
  (example-draw-line)
  (example-draw-rect)
  (example-draw-triangle)
  (example-draw-circle)
  (example-invert-display)
  (example-draw-string)
  (example-draw-bmp))
